<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Supermarket Sales</title>

    <!-- Cargar Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        .chart-container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body>

    <h1>Dashboard — Supermarket Sales</h1>

    <!-- Contenedores de gráficos -->
    <div class="chart-container"><div id="chart1"></div></div>
    <div class="chart-container"><div id="chart2"></div></div>
    <div class="chart-container"><div id="chart3"></div></div>
    <div class="chart-container"><div id="chart4"></div></div>

    <script>
        // ==========================
        // Cargar dataset (CSV en GitHub)
        // ==========================

        const URL_CSV = "supermarket_sales.csv"; 
        // Si subís el archivo a GitHub Pages, poner:
        // const URL_CSV = "https://Guillermina0406.github.io/Supermarket_Sales/supermarket_sales.csv"

        Plotly.d3.csv(URL_CSV, function(err, rawData) {
            if (err) {
                console.error("Error al cargar CSV", err);
                return;
            }

            // Convertir datos
            const df = rawData.map(d => ({
                ...d,
                Total: parseFloat(d.Total),
                Date: new Date(d.Date)
            }));

            // ===============================
            // 1) TOP 3 PRODUCT LINES
            // ===============================
            let totals = {};
            df.forEach(d => {
                totals[d["Product line"]] = (totals[d["Product line"]] || 0) + d.Total;
            });

            let sorted = Object.entries(totals).sort((a, b) => b[1] - a[1]).slice(0, 3);

            Plotly.newPlot("chart1", [{
                type: "bar",
                x: sorted.map(d => d[0]),
                y: sorted.map(d => d[1])
            }], {
                title: "Top 3 Product Lines"
            });

            // ===============================
            // 2) REVENUE POR CIUDAD
            // ===============================
            let city = {};
            df.forEach(d => {
                city[d.City] = (city[d.City] || 0) + d.Total;
            });

            Plotly.newPlot("chart2", [{
                type: "bar",
                x: Object.keys(city),
                y: Object.values(city)
            }], {
                title: "Facturación por Ciudad"
            });

            // ===============================
            // 3) TICKET PROMEDIO
            // ===============================
            const avg = df.reduce((a, b) => a + b.Total, 0) / df.length;

            Plotly.newPlot("chart3", [{
                type: "indicator",
                mode: "number",
                value: avg,
                title: { text: "Ticket Promedio" }
            }]);

            // ===============================
            // 4) CURVA MENSUAL
            // ===============================
            let monthly = {};

            df.forEach(d => {
                const ym = d.Date.getFullYear() + "-" + (String(d.Date.getMonth()+1).padStart(2,"0"));
                monthly[ym] = (monthly[ym] || 0) + d.Total;
            });

            const months = Object.keys(monthly).sort();

            Plotly.newPlot("chart4", [{
                type: "scatter",
                mode: "lines+markers",
                x: months,
                y: months.map(m => monthly[m])
            }], {
                title: "Curva Mensual de Ventas"
            });

        });
    </script>

</body>
</html>
